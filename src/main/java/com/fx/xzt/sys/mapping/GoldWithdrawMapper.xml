<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fx.xzt.sys.mapper.GoldWithdrawMapper">
	<resultMap id="BaseResultMap" type="com.fx.xzt.sys.entity.GoldWithdraw">
		<id column="id" jdbcType="BIGINT" property="id" />
	    <result column="user_id" jdbcType="BIGINT" property="userId" />
	    <result column="type" jdbcType="SMALLINT" property="type" />
	    <result column="amount" jdbcType="REAL" property="amount" />
	    <result column="fee" jdbcType="INTEGER" property="fee" />
	    <result column="insurance" jdbcType="INTEGER" property="insurance" />
	    <result column="logistics_fee" jdbcType="INTEGER" property="logisticsFee" />
	    <result column="apply_time" jdbcType="TIMESTAMP" property="applyTime" />
	    <result column="send_time" jdbcType="TIMESTAMP" property="sendTime" />
	    <result column="status" jdbcType="SMALLINT" property="status" />
	    <result column="logistics_no" jdbcType="VARCHAR" property="logisticsNo" />
	    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
	</resultMap>
	
	<!--黄金提取查询开始-htt-->
	<select id="selectByGoldWithdraw" resultType="java.util.Map" parameterType="java.util.Map">
	    SELECT w.id id, w.user_id userId, w.type type, w.amount amount, w.fee fee, w.insurance insurance, w.logistics_fee logisticsFee, 
		w.apply_time applyTime, w.send_time sendTime, w.status status, w.logistics_no logisticsNo, w.update_time updateTime,
		u.UserName userName, i.agent_id AS agentId, ua.user_name AS agentName, i.broker_id AS brokerId, ub.user_name AS brokerName,
		a.contact_name contactName, a.contact_phone contactPhone, a.delivery_address deliveryAddress
		FROM gold_withdraw w
		LEFT JOIN user_address a ON w.user_id = a.user_id
		LEFT JOIN User_Login u ON w.user_id = u.UserID
		LEFT JOIN User_Info i ON u.UserID = i.UserID
		LEFT JOIN users ua ON i.agent_id = ua.id
		LEFT JOIN users ub ON i.broker_id = ub.id
	    <where>
	      and u.Status = 1
	      <if test="userName != null and userName !=''">
	        and u.UserName = #{userName,jdbcType=VARCHAR}
	      </if>
	      <if test="startTime !=null and startTime !='' ">
	        and w.apply_time &gt;=#{startTime,jdbcType=TIMESTAMP}
	      </if>
	      <if test="endTime !=null and endTime !='' ">
	        and w.apply_time &lt;=#{endTime,jdbcType=TIMESTAMP}
	      </if>
	       <if test="agentName != null and agentName !='' ">
	        and ua.user_name = #{agentName,jdbcType=VARCHAR}
	      </if>
	      <if test="brokerName != null and brokerName !='' ">
	        and ub.user_name = #{brokerName,jdbcType=VARCHAR}
	      </if>
	      <if test="status != null and status !='' ">
	        and w.status = #{status,jdbcType=INTEGER}
	      </if>
	    </where>
	    order by w.apply_time desc
  	</select>
	<!--黄金提取查询结束-htt-->
	<!--黄金提取查询统计开始-htt-->
	<select id="selectByGoldWithdrawCount" resultType="java.util.Map" parameterType="java.util.Map">
	    SELECT SUM(amount) amountSum, SUM(insurance) insuranceSum, SUM(logistics_fee) logisticsFeeSum 
		FROM gold_withdraw w
		LEFT JOIN user_address a ON w.user_id = a.user_id
		LEFT JOIN User_Login u ON w.user_id = u.UserID
		LEFT JOIN User_Info i ON u.UserID = i.UserID
		LEFT JOIN users ua ON i.agent_id = ua.id
		LEFT JOIN users ub ON i.broker_id = ub.id
	    <where>
	      and u.Status = 1
	      <if test="userName != null and userName !=''">
	        and u.UserName = #{userName,jdbcType=VARCHAR}
	      </if>
	      <if test="startTime !=null and startTime !='' ">
	        and w.apply_time &gt;=#{startTime,jdbcType=TIMESTAMP}
	      </if>
	      <if test="endTime !=null and endTime !='' ">
	        and w.apply_time &lt;=#{endTime,jdbcType=TIMESTAMP}
	      </if>
	       <if test="agentName != null and agentName !='' ">
	        and ua.user_name = #{agentName,jdbcType=VARCHAR}
	      </if>
	      <if test="brokerName != null and brokerName !='' ">
	        and ub.user_name = #{brokerName,jdbcType=VARCHAR}
	      </if>
	      <if test="status != null and status !='' ">
	        and w.status = #{status,jdbcType=INTEGER}
	      </if>
	    </where>
	    order by w.apply_time desc
  	</select>
	<!--黄金提取查询统计结束-htt-->
	<!-- 黄金提取修改开始-htt -->
	<update id="updateById" parameterType="com.fx.xzt.sys.entity.GoldWithdraw">
    	update gold_withdraw
    	<set>
	    	<if test="amount != null and amount !=''">
	        	amount = #{amount,jdbcType=REAL},
	        </if>
	        <if test="fee != null and fee !=''">
	        	fee = #{fee,jdbcType=INTEGER},
	        </if>
	        <if test="insurance != null and insurance !=''">
	        	insurance = #{insurance,jdbcType=INTEGER},
	        </if>
	        <if test="logisticsFee != null and logisticsFee !=''">
	        	logistics_fee = #{logisticsFee,jdbcType=INTEGER},
	        </if>
	        <if test="applyTime != null and applyTime !=''">
	        	apply_time = #{applyTime,jdbcType=TIMESTAMP},
	        </if>
	        <if test="sendTimeString != null and sendTimeString !=''">
	        	send_time = #{sendTimeString,jdbcType=TIMESTAMP},
	        </if>
	        <if test="status != null and status !=''">
	        	status = #{status,jdbcType=SMALLINT},
	        </if>
	        <if test="logisticsNo != null and logisticsNo !=''">
	        	logistics_no = #{logisticsNo,jdbcType=VARCHAR},
	        </if>
	        <if test="updateTimeString != null and updateTimeString !=''">
	        	update_time = #{updateTimeString,jdbcType=TIMESTAMP},
	        </if>
    	</set>
    	where id = #{id,jdbcType=BIGINT}
  </update>
	<!-- 黄金提取修改结束-htt -->
</mapper>