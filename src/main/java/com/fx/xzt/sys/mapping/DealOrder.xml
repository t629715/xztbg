<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fx.xzt.sys.mapper.DealOrderMapper">
    <resultMap id="BaseResultMap" type="com.fx.xzt.sys.entity.DealOrder">
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="order_no" jdbcType="VARCHAR" property="orderNo"/>
        <result column="user_id" jdbcType="BIGINT" property="userId"/>
        <result column="product_id" jdbcType="BIGINT" property="productId"/>
        <result column="up_or_down" jdbcType="INTEGER" property="upOrDown"/>
        <result column="open_position_price" jdbcType="DOUBLE" property="openPositionPrice"/>
        <result column="close_position_price" jdbcType="DOUBLE" property="closePositionPrice"/>
        <result column="point_count" jdbcType="DOUBLE" property="pointCount"/>
        <result column="hand_number" jdbcType="INTEGER" property="handNumber"/>
        <result column="order_state" jdbcType="INTEGER" property="orderState"/>
        <result column="end_profit" jdbcType="DOUBLE" property="endProfit"/>
        <result column="end_profit_number" jdbcType="INTEGER" property="endProfitNumber"/>
        <result column="end_loss" jdbcType="DOUBLE" property="endLoss"/>
        <result column="end_loss_number" jdbcType="INTEGER" property="endLossNumber"/>
        <result column="poundage" jdbcType="INTEGER" property="poundage"/>
        <result column="ensure_amount" jdbcType="INTEGER" property="ensureAmount"/>
        <result column="profit_loss" jdbcType="INTEGER" property="profitLoss"/>
        <result column="profit_loss_number" jdbcType="INTEGER" property="profitLossNumber"/>
        <result column="display" jdbcType="INTEGER" property="display"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="end_time" jdbcType="TIMESTAMP" property="endTime"/>
        <result column="close_position_method" jdbcType="INTEGER" property="closePositionMethod"/>
        <result column="close_position_user" jdbcType="INTEGER" property="closePositionUser"/>
        <result column="order_ip" jdbcType="VARCHAR" property="orderIp"/>
        <result column="voucher_value" jdbcType="INTEGER" property="voucherValue"/>
        <result column="voucher_deductible" jdbcType="DOUBLE" property="voucherDeductible"/>
        <result column="voucher_id" jdbcType="BIGINT" property="voucherId"/>
        <result column="buy_pre_rmb" jdbcType="BIGINT" property="buyPreRmb"/>
        <result column="buy_after_rmb" jdbcType="BIGINT" property="buyAfterRmb"/>
    </resultMap>

    <!--金权交易开始-htt-->
    <select id="selectByDealOrder" resultType="java.util.Map" parameterType="java.util.Map">
      SELECT o.id id, o.order_no orderNo, o.user_id userID, u.UserName userName,DATE_FORMAT(i.RegisterTime, '%Y-%m-%d %h:%i:%s')  registerTime,
      i.agent_id AS agentId, ua.user_name AS agentName, i.broker_id AS brokerId, ub.user_name AS brokerName ,
      o.product_id productId, c.name productName,o.up_or_down upOrDown, o.hand_number handNumber,
      o.ensure_amount ensureAmount, o.point_count pointCount,o.open_position_price openPositionPrice, o.close_position_price closePositionPrice,
      DATE_FORMAT(o.create_time, '%Y-%m-%d %h:%i:%s')  createTime, DATE_FORMAT(o.end_time, '%Y-%m-%d %h:%i:%s') endTime, o.profit_loss_number profitLossNumber, o.order_state orderState,
      o.buy_pre_rmb buyPreRmb, o.buy_after_rmb buyAfterRmb
      FROM deal_order o
      LEFT JOIN User_Login u ON o.user_id = u.UserID
      LEFT JOIN User_Info i ON u.UserID = i.UserID
      LEFT JOIN users ua ON i.agent_id = ua.id
      LEFT JOIN users ub ON i.broker_id = ub.id
      LEFT JOIN gold_right_deal_conf c ON o.product_id = c.id
      <where>
          and u.Status = 1
          <if test="userName != null and userName != '' ">
            and i.userName = #{userName,jdbcType=VARCHAR}
          </if>
          <if test="orderNo != null and orderNo != '' ">
              and o.order_no = #{orderNo,jdbcType=VARCHAR}
          </if>
          <if test="startTime !=null and startTime !='' ">
              and o.create_time &gt;=#{startTime,jdbcType=TIMESTAMP}
          </if>
          <if test="endTime !=null and endTime != '' ">
              and o.create_time &lt;=#{endTime,jdbcType=TIMESTAMP}
          </if>
          <if test="regStartTime !=null and regStartTime !='' ">
              and i.RegisterTime &gt;=#{regStartTime,jdbcType=TIMESTAMP}
          </if>
          <if test="regEndTime !=null and regEndTime != '' ">
              and i.RegisterTime &lt;=#{regEndTime,jdbcType=TIMESTAMP}
          </if>
          <if test="agentName != null and agentName !='' ">
              and ua.user_name = #{agentName,jdbcType=VARCHAR}
          </if>
          <if test="brokerName != null and brokerName !='' ">
              and ub.user_name = #{brokerName,jdbcType=VARCHAR}
          </if>
          <if test="orderState != null and orderState !='' ">
              and o.order_state = #{orderState,jdbcType=INTEGER}
          </if>
      </where>
        order by o.create_time DESC
    </select>
    <!--金权交易结束-htt-->
    <!--金权交易金额统计开始-htt-->
    <select id="selectByDealOrderCount" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT SUM(ensure_amount) enSureAmountSum, SUM(profit_loss_number) profitLossNumberCount
        FROM deal_order o
        LEFT JOIN User_Login u ON o.user_id = u.UserID
        LEFT JOIN User_Info i ON u.UserID = i.UserID
        LEFT JOIN users ua ON i.agent_id = ua.id
        LEFT JOIN users ub ON i.broker_id = ub.id
        <where>
            and u.Status = 1
            <if test="userName != null and userName != '' ">
                and i.userName = #{userName,jdbcType=VARCHAR}
            </if>
            <if test="orderNo != null and orderNo != '' ">
                and o.order_no = #{orderNo,jdbcType=VARCHAR}
            </if>
            <if test="startTime !=null and startTime !='' ">
                and o.create_time &gt;=#{startTime,jdbcType=TIMESTAMP}
            </if>
            <if test="endTime !=null and endTime != '' ">
                and o.create_time &lt;=#{endTime,jdbcType=TIMESTAMP}
            </if>
            <if test="regStartTime !=null and regStartTime !='' ">
                and i.RegisterTime &gt;=#{regStartTime,jdbcType=TIMESTAMP}
            </if>
            <if test="regEndTime !=null and regEndTime != '' ">
                and i.RegisterTime &lt;=#{regEndTime,jdbcType=TIMESTAMP}
            </if>
            <if test="agentName != null and agentName !='' ">
                and ua.user_name = #{agentName,jdbcType=VARCHAR}
            </if>
            <if test="brokerName != null and brokerName !='' ">
                and ub.user_name = #{brokerName,jdbcType=VARCHAR}
            </if>
            <if test="orderState != null and orderState !='' ">
                and o.order_state = #{orderState,jdbcType=INTEGER}
            </if>
        </where>
    </select>
    <!--金权交易金额统计结束-htt-->
</mapper>